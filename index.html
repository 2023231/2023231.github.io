<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI ì˜¤ëª© (ë©”ë‰´+íˆ¬ëª… GUI+í°ìƒ‰ ë²„íŠ¼)</title>
<style>
  body {
    margin: 0;
    font-family: 'Pretendard', sans-serif;
    background: #f0d9b5;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow: hidden;
  }

  h1 { margin: 15px 0 5px; }

  #board {
    display: grid;
    grid-template-columns: repeat(15, 40px);
    grid-template-rows: repeat(15, 40px);
    background-color: #deb887;
    border: 2px solid #000;
    opacity: 0;
    transition: opacity 1s ease;
  }

  .cell {
    width: 40px; height: 40px;
    border: 1px solid #00000044;
    display: flex; justify-content: center; align-items: center;
    cursor: pointer;
  }

  .black, .white {
    border-radius: 50%;
    width: 32px; height: 32px;
  }

  .black { background: black; }
  .white { background: white; border: 1px solid #555; }

  #status, #timer {
    margin-top: 10px;
    font-size: 1.1em;
    opacity: 0;
    transition: opacity 1s ease;
  }

  /* ğŸ¨ ë©”ë‰´ ì˜¤ë²„ë ˆì´ */
  #menu {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.75);
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10;
    transition: opacity 1s ease;
  }

  #menu h2 {
    font-size: 2em;
    margin-bottom: 20px;
  }

  /* ğŸ–±ï¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  #startBtn, #restart {
    padding: 10px 20px;
    font-size: 1.1em;
    margin: 10px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s;
  }

  /* ì‹œì‘ ë²„íŠ¼ì€ ë°ì€ í†¤ */
  #startBtn {
    background: #f0d9b5;
    color: #000;
  }
  #startBtn:hover { background: #e6c894; }

  /* ğŸ”¥ ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ì€ ì–´ë‘ìš´ ë°°ê²½ + í°ìƒ‰ ê¸€ì”¨  */
  #restart {
    background: #333;
    color: white;
  }
  #restart:hover {
    background: #555;
  }
</style>
</head>
<body>
  <div id="menu">
    <h2>AI ì˜¤ëª©</h2>
    <p>ë£°: í‘ì„ , ì‚¼ì‚¼ê¸ˆì§€, ìœ¡ëª©ê¸ˆì§€, 5ë¶„ ì œí•œ</p>
    <button id="startBtn">ê²Œì„ ì‹œì‘</button>
  </div>

  <h1>AI ì˜¤ëª© (í‘ì„ , 5ë¶„ ì œí•œ)</h1>
  <div id="board"></div>
  <div id="status">ë‹¹ì‹ ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤ (í‘).</div>
  <div id="timer">ë‚¨ì€ ì‹œê°„: 05:00</div>
  <button id="restart">ë‹¤ì‹œí•˜ê¸°</button>

<script>
const size = 15;
let board, turn, timeLeft, timerInterval;
const boardEl = document.getElementById('board');
const statusEl = document.getElementById('status');
const timerEl = document.getElementById('timer');
const restartBtn = document.getElementById('restart');
const menuEl = document.getElementById('menu');
const startBtn = document.getElementById('startBtn');

startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', showMenu);

function showMenu() {
  clearInterval(timerInterval);
  menuEl.style.opacity = '1';
  menuEl.style.pointerEvents = 'all';
  boardEl.style.opacity = '0';
  statusEl.style.opacity = '0';
  timerEl.style.opacity = '0';
}

function startGame() {
  menuEl.style.opacity = '0';
  menuEl.style.pointerEvents = 'none';
  setTimeout(() => {
    boardEl.style.opacity = '1';
    statusEl.style.opacity = '1';
    timerEl.style.opacity = '1';
    init();
  }, 300);
}

function init() {
  board = Array.from({length: size}, () => Array(size).fill(0));
  turn = 1;
  boardEl.innerHTML = '';
  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.x = x;
      cell.dataset.y = y;
      cell.addEventListener('click', handleClick);
      boardEl.appendChild(cell);
    }
  }
  statusEl.textContent = "ë‹¹ì‹ ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤ (í‘)";
  startTimer();
  render();
}

function startTimer() {
  clearInterval(timerInterval);
  timeLeft = 5 * 60;
  timerInterval = setInterval(() => {
    timeLeft--;
    const m = String(Math.floor(timeLeft / 60)).padStart(2,'0');
    const s = String(timeLeft % 60).padStart(2,'0');
    timerEl.textContent = `ë‚¨ì€ ì‹œê°„: ${m}:${s}`;
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      alert("ì‹œê°„ ì´ˆê³¼! íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤.");
      disableBoard();
    }
  }, 1000);
}

function handleClick(e) {
  if (turn !== 1) return;
  const x = +e.target.dataset.x;
  const y = +e.target.dataset.y;
  if (board[y][x] !== 0) return;

  if (isForbidden(x, y)) {
    alert('ê¸ˆìˆ˜ ìœ„ì¹˜ì…ë‹ˆë‹¤! (ì‚¼ì‚¼ ë˜ëŠ” ìœ¡ëª© ê¸ˆì§€)');
    return;
  }

  board[y][x] = 1;
  render();
  if (checkWin(x, y)) {
    statusEl.textContent = "ë‹¹ì‹ (í‘)ì˜ ìŠ¹ë¦¬!";
    clearInterval(timerInterval);
    disableBoard();
    return;
  }

  turn = 2;
  statusEl.textContent = "AIì˜ ì°¨ë¡€ì…ë‹ˆë‹¤...";
  setTimeout(aiMove, 600);
}

// ğŸ¤– AI ìˆ˜ì½ê¸° ë²„ì „
function aiMove() {
  const move = findBestMove();
  if (!move) return;
  const [x, y] = move;
  board[y][x] = 2;
  render();
  if (checkWin(x, y)) {
    statusEl.textContent = "AI(ë°±)ì˜ ìŠ¹ë¦¬!";
    clearInterval(timerInterval);
    disableBoard();
    return;
  }
  turn = 1;
  statusEl.textContent = "ë‹¹ì‹ ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤ (í‘)";
}

function findBestMove() {
  let bestScore = -Infinity;
  let bestMove = null;
  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      if (board[y][x] !== 0) continue;
      let score = evaluateMove(x, y, 2);
      let defense = evaluateMove(x, y, 1);
      score += defense * 1.1;
      if (score > bestScore) {
        bestScore = score;
        bestMove = [x, y];
      }
    }
  }
  return bestMove;
}

function evaluateMove(x, y, color) {
  const opponent = color === 1 ? 2 : 1;
  let score = 0;
  for (const [dx, dy] of dirs) {
    const line = getLine(x, y, dx, dy, color);
    if (/XXXXX/.test(line)) score += 100000;
    else if (/OXXXXO/.test(line)) score += 10000;
    else if (/OXXXXB|BXXXXO/.test(line)) score += 5000;
    else if (/OXXXO/.test(line)) score += 1000;
    else if (/OXXXB|BXXXO/.test(line)) score += 400;
    else if (/OXXO/.test(line)) score += 100;
  }
  return score;
}

function getLine(x, y, dx, dy, color) {
  let line = '';
  for (let i = -4; i <= 4; i++) {
    const nx = x + dx * i;
    const ny = y + dy * i;
    if (nx < 0 || ny < 0 || nx >= size || ny >= size) line += 'B';
    else if (nx === x && ny === y) line += 'X';
    else if (board[ny][nx] === color) line += 'X';
    else if (board[ny][nx] === 0) line += 'O';
    else line += 'B';
  }
  return line;
}

const dirs = [[1,0],[0,1],[1,1],[1,-1]];

function checkWin(x, y) {
  const color = board[y][x];
  for (const [dx, dy] of dirs) {
    let count = 1;
    for (let dir of [1, -1]) {
      let nx = x + dx * dir;
      let ny = y + dy * dir;
      while (nx >= 0 && ny >= 0 && nx < size && ny < size && board[ny][nx] === color) {
        count++;
        nx += dx * dir;
        ny += dy * dir;
      }
    }
    if (count === 5) return true;
  }
  return false;
}

function isForbidden(x, y) {
  board[y][x] = 1;
  const openThrees = countOpenThrees(x, y);
  const overline = checkOverline(x, y);
  board[y][x] = 0;
  return openThrees >= 2 || overline;
}

function countOpenThrees(x, y) {
  let count = 0;
  for (const [dx, dy] of dirs) {
    if (getLinePattern(x, y, dx, dy) === 'open3') count++;
  }
  return count;
}

function getLinePattern(x, y, dx, dy) {
  const color = 1;
  let line = '';
  for (let i = -4; i <= 4; i++) {
    const nx = x + dx * i;
    const ny = y + dy * i;
    if (nx < 0 || ny < 0 || nx >= size || ny >= size) line += 'E';
    else if (board[ny][nx] === 0 && !(nx===x && ny===y)) line += 'O';
    else if (nx===x && ny===y) line += 'X';
    else if (board[ny][nx] === color) line += 'X';
    else line += 'B';
  }
  if (/OXXXO/.test(line)) return 'open3';
  return '';
}

function checkOverline(x, y) {
  const color = 1;
  for (const [dx, dy] of dirs) {
    let count = 1;
    for (let dir of [1, -1]) {
      let nx = x + dx * dir;
      let ny = y + dy * dir;
      while (nx >= 0 && ny >= 0 && nx < size && ny < size && board[ny][nx] === color) {
        count++;
        nx += dx * dir;
        ny += dy * dir;
      }
    }
    if (count > 5) return true;
  }
  return false;
}

function render() {
  document.querySelectorAll('.cell').forEach(cell => {
    const x = +cell.dataset.x;
    const y = +cell.dataset.y;
    cell.innerHTML = '';
    if (board[y][x] === 1) cell.appendChild(makeStone('black'));
    if (board[y][x] === 2) cell.appendChild(makeStone('white'));
  });
}

function makeStone(color) {
  const s = document.createElement('div');
  s.className = color;
  return s;
}

function disableBoard() {
  document.querySelectorAll('.cell').forEach(c => c.removeEventListener('click', handleClick));
}
</script>
</body>
</html>
